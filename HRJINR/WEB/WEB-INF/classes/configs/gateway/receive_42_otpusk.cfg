{ "Тип": "Отпуска организаций",
"Элемент": "Отпуска организаций 00000014945 от 28.10.2019 17:06:44",
"Элемент_Ref": "2b84e958-f98c-11e9-bbee-506b4b139a8b",
"Организация": "ОИЯИ",
"Организация_Ref": "35e7627d-d7be-11e1-bad5-e0cb4eda5b1f",
"Ответственный": "Шабанова Е.Ю.",
"Ответственный_Ref": "ff7ab7e2-5f38-11e2-8dfa-000e0ce597c9",
"КраткийСоставДокумента": "Алтангэрэл Б.",
"ДанныеПрошлойВерсии": "Нет",
"ДвиженияИсправляемогоДокумента": "ХранилищеЗначения",
"ОИЯИ_ДатаЗаявления": "28.10.2019 0:00:00",
"ОИЯИ_РезолюцияРуководителя": "Козленко Денис Петрович",
"ОИЯИ_РезолюцияРуководителя_Ref": "23bc095f-0fb8-11e2-9f27-000e0ce597c9",
"ФизЛицо_Ref": [ 
{ "Сотрудник": "Алтангэрэл Бадмаараг",
"Сотрудник Ref": "884227a3-5fc1-11e2-b3f2-000e0ce597c9",
"ФизЛицо": "Алтангэрэл Бадмаараг",
"ФизЛицо Ref": "884227a2-5fc1-11e2-b3f2-000e0ce597c9",
"ОсвобождатьСтавку": "Нет",
"ДатаНачала": "05.11.2019 0:00:00",
"ДатаОкончания": "27.11.2019 0:00:00",
"УдалитьПроизошедшееСобытие": "Нет",
"ПричинаОтсутствия": "Отпуск ежегодный",
"РабочийГодС": "13.12.2018 0:00:00",
"РабочийГодПо": "12.12.2020 0:00:00",
"НапомнитьПоЗавершении": "Нет",
"Сторно": "Нет",
"КоличествоДней": "23",
"ОИЯИ_ВыплатитьПолОклада": "Нет" 
}
 ],
"ЗначениеРеквизита_Ref": [ { "ДополнительныйРеквизит": "Подпись руководителя структурного подразделения",
"ЗначениеРеквизита": "Тютюнникова Людмила Александровна",
"ЗначениеРеквизита Ref": "5d2dbca0-0fb8-11e2-9f27-000e0ce597c9" 
} ] 
}  TEMPLATE

[comments]
descr=S: Прием из шлюза отпусков
input=Command - команда, object - объект в JSON + распарзенные параметры из JSON
output=занесение / пометка удаленным / снятие пометки в таблице sotrudniki
parents=gateway/receive
author=Семашко

[end]

[description]
[end]
[report]
    $LOG <hr><b>receive_42_otpusk</b>
    
    $LOG7 object=#Object#;<br>
    $IF !SrcObjectID
        $SET_PARAMETERS ResultCode=1; Result=отсутствует SrcObjectID
        $BREAK
    $EIF
    $SET_PARAMETERS guid=#ФизЛицо_Ref.1.Сотрудник_Ref#
    $SET_PARAMETERS ERR_CODE=0; ERROR=; 
    $GET_DATA gateway/receive.cfg[get tab_n by guid] 
    $SET_PARAMETERS ResultCode=0

    $SET_PARAMETERS ERR_CODE=0; ERROR=; 
    Экранирование и замена кавычек ??
    $JS{
      var a=prm('Object');

	while (a.indexOf('\\"')>=0){
        	a = a.replace('\\"','\\\'')   
	}
      setPrm('Object',a);
    $JS}
    $GET_DATA [update absence]
[end]
[update absence] 
   replace  absence (guid_src_1c,tab_n,guid_sotr, st_date, fin_date, reason, comment, object) 
        values('#SrcObjectID#',#tab_n#,'#guid#',STR_TO_DATE('#ФизЛицо_Ref.1.ДатаНачала#', '%d.%m.%Y %H:%i:%s'),STR_TO_DATE('#ФизЛицо_Ref.1.ДатаОкончания#', '%d.%m.%Y %H:%i:%s'),
                1,  '#ФизЛицо_Ref.1.ПричинаОтсутствия#', '#Object#') 
[end]

