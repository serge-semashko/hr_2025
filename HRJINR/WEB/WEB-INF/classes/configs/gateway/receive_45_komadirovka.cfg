{ "Тип": "Командировки организаций",
"Элемент": "Командировки организаций РФ000014958 от 15.10.2019 10:00:12",
"Элемент_Ref": "00d47654-fa1e-11e9-bbf0-506b4b139a8b",
"Организация": "ОИЯИ",
"Организация_Ref": "35e7627d-d7be-11e1-bad5-e0cb4eda5b1f",
"СтранаНазначения": "Россия,
Москва",
"ОрганизацияНазначения": "МГУ",
"Комментарий": "Автоматически создан на основании документа Командировки по России 00000002615 от 15.10.2019 10:00:12",
"Ответственный": "Сергеева Н.С.",
"Ответственный_Ref": "a8e2bcbe-89a6-11e3-9407-0025907d24fa",
"КраткийСоставДокумента": "Зайкина О.Н.",
"ДанныеПрошлойВерсии": "Нет",
"ДвиженияИсправляемогоДокумента": "ХранилищеЗначения",
"ФизЛицо_Ref": [ { "Сотрудник": "Зайкина Ольга Николаевна",
"Сотрудник Ref": "db53473a-d537-11e9-bbde-506b4b139a8b",
"ФизЛицо": "Зайкина Ольга Николаевна",
"ФизЛицо Ref": "db534739-d537-11e9-bbde-506b4b139a8b",
"ДатаНачала": "16.10.2019 0:00:00",
"ДатаОкончания": "17.10.2019 0:00:00",
"ОсвобождатьСтавку": "Нет",
"УдалитьПроизошедшееСобытие": "Нет",
"Цель": "участие в конференции",
"НапомнитьПоЗавершении": "Нет",
"Сторно": "Нет" 
} ],
"ОИЯИ_ДополнительныеРеквизиты": [ { "ДополнительныйРеквизит": "Подпись руководителя организации" 
} ],
"Страна_направления": "РОССИЯ",
"Основание": "Командировка по России" 
}
[comments]
descr=S: Прием из шлюза командировок
input=Command - команда, object - объект в JSON + распарзенные параметры из JSON
output=занесение / пометка удаленным / снятие пометки в таблице sotrudniki
parents=gateway/receive
author=Семашко

[end]

[description]
[end]

[report]
    $LOG <hr><b>receive_45_otpusk</b>
    
    $LOG7 object=#Object#;<br>
    $IF !SrcObjectID
        $SET_PARAMETERS ResultCode=1; Result=отсутствует SrcObjectID
        $BREAK
    $EIF
    $SET_PARAMETERS ERR_CODE=0; ERROR=; 
    $SET_PARAMETERS guid=#ФизЛицо_Ref.1.Сотрудник_Ref#
    $GET_DATA gateway/receive.cfg[get tab_n by guid] 
    $SET_PARAMETERS ResultCode=0

    $SET_PARAMETERS ERR_CODE=0; ERROR=; comment=Основание:#Основание# Страна Назначения:#СтранаНазначения# Организация Назначения:#ОрганизацияНазначения#
    $LOG2 ================================================================================
    $LOG2 Страна Назначения #СтранаНазначения# Организация Назначения #ОрганизацияНазначения# Основание #Основание# <br>
    $LOG2 comment = #comment# <br>
    Экранирование и замена кавычек ??
    $JS{
      var a=prm('Object');

	while (a.indexOf('\\"')>=0){
        	a = a.replace('\\"','\\\'')   
	}
      setPrm('Object',a);
    $JS}
    $GET_DATA [update absence]
[end]
[update absence] 
   replace  absence (guid_src_1c,tab_n,guid_sotr, st_date, fin_date, reason, comment,object) 
        values('#SrcObjectID#',#tab_n#,'#guid#',STR_TO_DATE('#ФизЛицо_Ref.1.ДатаНачала#', '%d.%m.%Y %H:%i:%s'),STR_TO_DATE('#ФизЛицо_Ref.1.ДатаОкончания#', '%d.%m.%Y %H:%i:%s'),
                100,  '#comment#','#Object#') 
[end]

