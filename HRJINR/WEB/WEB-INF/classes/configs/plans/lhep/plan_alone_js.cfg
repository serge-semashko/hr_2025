TEMPLATE


[comments]
    author=Семашко
[end]



[divfunc]
function lhep_divFunc(id) {

        var item = "";
        var flag = 0;
        var lvl = 1;
        debugger;
        for (i in lit_divs) {
            if (id == lit_divs[i].id) {

                var str = lit_divs[i].name;
                lvl = lit_divs[i].lvl;
                break;
            }

        }
        debugger;

        if (lvl == 2) {

            str.replace(/,/g, '');
            var arr = str.split(/[\s-]+/);

            if (arr.length == 1) {
                return (str);
            } else {
                for (i in arr) {

                    if (arr[i].length > 2) {

                        item += arr[i][0].toUpperCase();

                    } else {
                        item += ' ' + arr[i] + ' ';
                    }

                }
//                console.log("item " + item);
                return item;
            }
        }

        if (lvl == 3) {

            str.replace(/,/g, '');
            var arr = str.split(/[\s-]+/);
            var index = 0;
            item = arr[0] + ' ';

            for (let i = 1; i < arr.length; i++) {

                    if (arr[i].length >= 5) {

                        if (arr[i][0].toUpperCase() == arr[i][0]) {

                            item += ' ' + arr[i] + ' ';

                        } else {

                            item += arr[i][0].toUpperCase();

                        }

                    } else {

                        item += ' ' + arr[i] + ' ';

                    }

            }
            //console.log("item " + item);
            return item;

        }
}
        


function lhep_divName(id) {

        var item = "";
        var flag = 0;
        var lvl = 1;
        let str = ' - ';
        for (i in lit_divs) {
            if (id == lit_divs[i].id) {

                str = lit_divs[i].name;
                lvl = lit_divs[i].lvl;
                break;
            }

        }
        return str;
}



[end]


[load marks]
        var             icon_data = [];
        var             data_array = [];

function loadBuildingIcon(building_id, floor_id, object_type, func) {
    let url = 'https://LT-SVR230.jinr.ru:8082/load_object_data?' + "building_id=" + building_id.toString() +
        "&floor_num=" + floor_id + "&object_type=" + object_type.toString();
    //let url = 'http://127.0.0.1:8082/load_object_data?' + "building_id=" + building_id.toString() +
        // "&floor_num=" + floor_id + "&object_type=" + object_type.toString();
    fetch(url)
        .then((response) => {
            if (response.ok) {
               // console.log('load connected');
                return response.json();
            } else {
             //   console.log('save failed');
            }
        })
        .then((data) => {
            func(data);
        });
}




        function load_all_icon(floor_num, build_id){
            object_type = 'markers';
            
            for(let i=0; i<icon_data.length; i++){
                icon_data[i].remove();
            }
            icon_data = [];
            data_array = [];
            loadBuildingIcon(build_id, floor_num, object_type, loadIcons);
        }


        function loadIcons(data){
            return;
            //console.log(data + ' ' + data.length);
            for (let i = 0; i < data.length; i++){
                console.log(icon_data);
                console.log(data[i]);
                coords = [data[i].geometry.coordinates[0]/10 + 6, data[i].geometry.coordinates[1]/10 - 2];
                obj_type = data[i].properties.type;
                obj_id = data[i].properties.id;
                obj_desc = data[i].properties.description;
                console.log('coord= ' + coords);
                console.log('type= ' + obj_type);
                let url1 = 'https://LT-SVR230.jinr.ru:8082/get_icon?' + "object_type=" + obj_type.toString() + "&object_name=" + obj_type.toString();


                var greenIcon = L.icon({
                    iconUrl: url1,
//                     iconSize: [38, 22], // size of the icon
                    iconAnchor: [0, 0], // point of the icon which will correspond to marker's location
                    popupAnchor: [-3, -76] // point from which the popup should open relative to the iconAnchor
                });

//                fetch(url1).then((response) => {
//                    if (response.ok) {
//                        console.log('connected');
//                        return response.text();
//                    }
//                }).then((data) => {
//                    // console.log(data);
//                    greenIcon.iconSize = data;
//                });

                obj_name = data[i].properties.name;

                var green_mark = L.marker(coords, {
                    icon: greenIcon
                }).addTo(roomsGrp);

                //var green_tst =      L.circle(coords, {fillOpacity: 0.51, color: '##FF0000', radius: 10}).addTo(lit_map);


                

//                    icon_data.push(green_mark);
//                    let descr = "<a href='#' onclick='showIconDescr(" + obj_id + "," + (icon_data.length - 1) + ");'> Icon " + (icon_data.length - 1) + " </a><br>";
                    
//                    green_mark.bindPopup(descr, {
//                        autoPanPaddingTopLeft: [50, 50]
//                        , className: "lhep_obj_popup"
//                    , }).on;
//                    green_mark.bindTooltip(obj_name, {
//                        permanent: true
//                        , direction: "center"
//                        , className: "lhep_obj_tooltip"
//                    , }).openTooltip();

//                green_mark.on('click', onIconClick, icon_data.length - 1);

//                green_mark.icon_attrib = {'type': obj_type, 'name': obj_name, 'description': obj_desc};
            }
        }

[end]


[phones]
var phones = [{'number': '2162013', 'room': '121', 'lab': 'LHEP', 'building': '2'},

 {'number': '2162045', 'room': '207', 'lab': 'LHEP', 'building': '217'},

 {'number': '2162046', 'room': '309', 'lab': 'LHEP', 'building': '2'},
 {'number': '2162071', 'room': '323', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162089', 'room': '22', 'lab': 'LHEP', 'building': '7 Ц.база'},
 {'number': '2162190', 'room': '209', 'lab': 'LHEP', 'building': '217'},
 {'number': '2162193', 'room': '441', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162224', 'room': '202', 'lab': 'LHEP', 'building': '2'},
 {'number': '2162276', 'room': '20', 'lab': 'LHEP', 'building': '217'},
 {'number': '2162283', 'room': '31', 'lab': 'LHEP', 'building': '39'},
 {'number': '2162328', 'room': '101', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162382', 'room': '216(конференцзал)', 'lab': 'LHEP', 'building': '217 Участок сборки СП магнитов (зал),'},
 {'number': '2162429', 'room': '430', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162474', 'room': '309', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162614', 'room': '208', 'lab': 'LHEP', 'building': '217'},
 {'number': '2162654', 'room': '21', 'lab': 'LHEP', 'building': '217'},
 {'number': '2162709', 'room': '21', 'lab': 'LHEP', 'building': '1А'},
 {'number': '2162803', 'room': '222(библиотека)', 'lab': 'LHEP', 'building': '3'},
 {'number': '2162840', 'room': '14', 'lab': 'LHEP', 'building': '43'},
 {'number': '2162861', 'room': '324', 'lab': 'LHEP', 'building': '3'},
 {'number': '2162854', 'room': '35', 'lab': 'LHEP', 'building': '32'},
 {'number': '2162837', 'room': '22', 'lab': 'LHEP', 'building': '1А'},
 {'number': '2162897', 'room': '313', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162902', 'room': '1 2этаж левое крыло', 'lab': 'LHEP', 'building': '42'},
 {'number': '2162906', 'room': '2 2этаж левое крыло', 'lab': 'LHEP', 'building': '42'},
 {'number': '2162879', 'room': '111', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162907', 'room': '18', 'lab': 'LHEP', 'building': '39'},
 {'number': '2162911', 'room': '1', 'lab': 'LHEP', 'building': '1Б'},
 {'number': '2162943', 'room': '4 2этаж левое крыло', 'lab': 'LHEP', 'building': '42'},
 {'number': '2162924', 'room': '23', 'lab': 'LHEP', 'building': '1А'},
 {'number': '2163028', 'room': '322', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162997', 'room': '24', 'lab': 'LHEP', 'building': '1А'},
 {'number': '2163054', 'room': '231', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163049', 'room': '205(левая сторона)', 'lab': 'LHEP', 'building': '42'},
 {'number': '2163055', 'room': '226', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163080', 'room': '48', 'lab': 'LHEP', 'building': '39'},
 {'number': '2163213', 'room': '110', 'lab': 'LHEP', 'building': '2'},
 {'number': '2163250', 'room': '305', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163260', 'room': '33', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2163310', 'room': '312,319', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163338', 'room': '34', 'lab': 'LHEP', 'building': '39'},
 {'number': '2163390', 'room': '314', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163441', 'room': '230, 228', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163443', 'room': '107', 'lab': 'LHEP', 'building': '2'},
 {'number': '2163513', 'room': '307', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163592', 'room': '22', 'lab': 'LHEP', 'building': 'старый криогенный'},
 {'number': '2163570', 'room': '301а', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2163632', 'room': '3', 'lab': 'LHEP', 'building': '1А'},
 {'number': '2163650', 'room': '201/1', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163722', 'room': '301', 'lab': 'LHEP', 'building': '2'},
 {'number': '2163712', 'room': '201', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163821', 'room': '314', 'lab': 'LHEP', 'building': '3'},
 {'number': '2163825', 'room': '303', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2163836', 'room': '28', 'lab': 'LHEP', 'building': '39'},
 {'number': '2163882', 'room': '434', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163934', 'room': '32', 'lab': 'LHEP', 'building': '39'},
 {'number': '2163915', 'room': '206', 'lab': 'LHEP', 'building': '2'},
 {'number': '2163904', 'room': ' 229, ком.228(на вр.ремонта данные 2165126)', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163949', 'room': '120', 'lab': 'LHEP', 'building': '216'},
 {'number': '2163992', 'room': '203', 'lab': 'LHEP', 'building': '216'},
 {'number': '2164034', 'room': 'мастера', 'lab': 'LHEP', 'building': '7'},
 {'number': '2164014', 'room': '21', 'lab': 'LHEP', 'building': '217'},
 {'number': '2164038', 'room': '203', 'lab': 'LHEP', 'building': '215'},
 {'number': '2164013', 'room': '440', 'lab': 'LHEP', 'building': '215'},
 {'number': '2164057', 'room': '207', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2164142', 'room': '111а, 111б', 'lab': 'LHEP', 'building': '201'},
 {'number': '2164145', 'room': '109, 317', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2164274', 'room': '202', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164261', 'room': '321', 'lab': 'LHEP', 'building': '215'},
 {'number': '2164276', 'room': '207', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164369', 'room': '112', 'lab': 'LHEP', 'building': '205 установка Дельта LNS'},
 {'number': '2164404', 'room': '25', 'lab': 'LHEP', 'building': '32(старый криогенный)'},
 {'number': '2164490', 'room': '301/2', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164503', 'room': '313', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164488', 'room': '202-1', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164573', 'room': '212', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164602', 'room': '206', 'lab': 'LHEP', 'building': '3'},
 {'number': '2164620', 'room': '209', 'lab': 'LHEP', 'building': '217'},
 {'number': '2164652', 'room': '237', 'lab': 'LHEP', 'building': '215'},
 {'number': '2164672', 'room': '5/2', 'lab': 'LHEP', 'building': '39'},
 {'number': '2164694', 'room': '45', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2164749', 'room': '103', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2164756', 'room': '445', 'lab': 'LHEP', 'building': '215'},
 {'number': '2164753', 'room': '106б', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2164805', 'room': '318', 'lab': 'LHEP', 'building': '215'},
 {'number': '2164853', 'room': '305', 'lab': 'LHEP', 'building': '3'},
 {'number': '2165031', 'room': '302', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2165015', 'room': '307', 'lab': 'LHEP', 'building': '201'},
 {'number': '2165025', 'room': '107', 'lab': 'LHEP', 'building': '2'},
 {'number': '2165054', 'room': '426', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165113', 'room': '29 ком.31', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2165116', 'room': '404', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165124', 'room': '305', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165143', 'room': '231', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165196', 'room': '210', 'lab': 'LHEP', 'building': '201'},
 {'number': '2165202', 'room': '124в', 'lab': 'LHEP', 'building': '2'},
 {'number': '2165178', 'room': '317', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165244', 'room': '213', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165329', 'room': '217', 'lab': 'LHEP', 'building': '3'},
 {'number': '2165391', 'room': '208', 'lab': 'LHEP', 'building': '201'},
 {'number': '2165416', 'room': '13', 'lab': 'LHEP', 'building': '7 Ц.база'},
 {'number': '2165448', 'room': '238', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165528', 'room': '411', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165593', 'room': '201', 'lab': 'LHEP', 'building': '1 здание инжектора ЛУ-20'},
 {'number': '2165612', 'room': '201', 'lab': 'LHEP', 'building': '3'},
 {'number': '2165578', 'room': '210', 'lab': 'LHEP', 'building': '3'},
 {'number': '2165654', 'room': '204', 'lab': 'LHEP', 'building': '3'},
 {'number': '2165652', 'room': '204', 'lab': 'LHEP', 'building': '2'},
 {'number': '2165653', 'room': '313б', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2165666', 'room': '38', 'lab': 'LHEP', 'building': '39(адм'},
 {'number': '2165715', 'room': '219', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165713', 'room': '202', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165756', 'room': '301', 'lab': 'LHEP', 'building': '3'},
 {'number': '2165776', 'room': '320', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165807', 'room': '101', 'lab': 'LHEP', 'building': '2'},
 {'number': '2165859', 'room': '30', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2165884', 'room': '26', 'lab': 'LHEP', 'building': '39'},
 {'number': '2165940', 'room': '45', 'lab': 'LHEP', 'building': '39'},
 {'number': '2165922', 'room': '35', 'lab': 'LHEP', 'building': '4'},
 {'number': '2165994', 'room': '23', 'lab': 'LHEP', 'building': '7 Ц.база'},
 {'number': '2166106', 'room': '121 СТИ', 'lab': 'LHEP', 'building': '2'},
 {'number': '2166107', 'room': '3', 'lab': 'LHEP', 'building': '202'},
 {'number': '2166238', 'room': '308', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2166420', 'room': '303', 'lab': 'LHEP', 'building': '3'},
 {'number': '2166425', 'room': '211', 'lab': 'LHEP', 'building': '215'},
 {'number': '2166551', 'room': '4', 'lab': 'LHEP', 'building': '202'},
 {'number': '2166619', 'room': '306', 'lab': 'LHEP', 'building': '205'},
 {'number': '2166589', 'room': '305', 'lab': 'LHEP', 'building': '201'},
 {'number': '2166754', 'room': '203', 'lab': 'LHEP', 'building': '236(модульный)'},
 {'number': '2167221', 'room': '114', 'lab': 'LHEP', 'building': '1'},
 {'number': '2167228', 'room': '309', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162060', 'room': '227', 'lab': 'LHEP', 'building': '215'},
 {'number': '2166267', 'room': '219', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163418', 'room': '16', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2163976', 'room': '103', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162948', 'room': '204', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163279', 'room': '2', 'lab': 'LHEP', 'building': '22'},
 {'number': '2165510', 'room': '103', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162904', 'room': '1', 'lab': 'LHEP', 'building': '1Б'},
 {'number': '2165658', 'room': '209', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162536', 'room': '216', 'lab': 'LHEP', 'building': '217'},
 {'number': '2165343', 'room': '223', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165180', 'room': '29', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2162800', 'room': '103а', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162823', 'room': '211', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162814', 'room': '2', 'lab': 'LHEP', 'building': '43'},
 {'number': '2166652', 'room': '2', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2162094', 'room': '103а', 'lab': 'LHEP', 'building': '2'},
 {'number': '2162985', 'room': ' 328', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162973', 'room': '311', 'lab': 'LHEP', 'building': '201'},
 {'number': '2165579', 'room': '303', 'lab': 'LHEP', 'building': '201'},
 {'number': '2166245', 'room': '101', 'lab': 'LHEP', 'building': '2'},
 {'number': '2164021', 'room': '325б', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164831', 'room': '325', 'lab': 'LHEP', 'building': '205'},
 {'number': '2166831', 'room': '21,23,24', 'lab': 'LHEP', 'building': '8Г'},
 {'number': '2162849', 'room': '9', 'lab': 'LHEP', 'building': '1А'},
 {'number': '2167224', 'room': '10', 'lab': 'LHEP', 'building': '2'},
 {'number': '2167226', 'room': '105', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162025', 'room': '318', 'lab': 'LHEP', 'building': '3'},
 {'number': '2164453', 'room': '118', 'lab': 'LHEP', 'building': '201'},
 {'number': '2163466', 'room': '116', 'lab': 'LHEP', 'building': '217'},
 {'number': '2162822', 'room': '132', 'lab': 'LHEP', 'building': '217'},
 {'number': '2162011', 'room': '205', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162065', 'room': '203', 'lab': 'LHEP', 'building': '201'},
 {'number': '2165804', 'room': '114', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162033', 'room': '325', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162035', 'room': '202', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162922', 'room': '311', 'lab': 'LHEP', 'building': '2 радиоаппаратный зал,'},
 {'number': '2162890', 'room': '201', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162043', 'room': '204', 'lab': 'LHEP', 'building': '217'},
 {'number': '2162020', 'room': '202/2', 'lab': 'LHEP', 'building': '2'},
 {'number': '2165960', 'room': '311', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162063', 'room': '225', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162083', 'room': '225', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162048', 'room': '5', 'lab': 'LHEP', 'building': '1А'},
 {'number': '2162049', 'room': '1 ком.5', 'lab': 'LHEP', 'building': '7 Ц.база'},
 {'number': '2162061', 'room': '204', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162072', 'room': '20', 'lab': 'LHEP', 'building': '7 Ц.база'},
 {'number': '2162098', 'room': '131', 'lab': 'LHEP', 'building': '217'},
 {'number': '2162087', 'room': '204', 'lab': 'LHEP', 'building': '217'},
 {'number': '2162093', 'room': '118-119', 'lab': 'LHEP', 'building': '3'},
 {'number': '2162096', 'room': '308', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2162131', 'room': '211', 'lab': 'LHEP', 'building': '217'},
 {'number': '2162269', 'room': '228', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162366', 'room': '438', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162488', 'room': '120', 'lab': 'LHEP', 'building': '217'},
 {'number': '2162053', 'room': '339', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162086', 'room': '19', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2162828', 'room': '14 слесарно-сборочный участок', 'lab': 'LHEP', 'building': '4'},
 {'number': '2162815', 'room': '306', 'lab': 'LHEP', 'building': '3'},
 {'number': '2162818', 'room': '424', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162821', 'room': '211', 'lab': 'LHEP', 'building': '3'},
 {'number': '2162866', 'room': '323', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162838', 'room': '36', 'lab': 'LHEP', 'building': '39'},
 {'number': '2162855', 'room': '43', 'lab': 'LHEP', 'building': '39'},
 {'number': '2162842', 'room': '102', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162847', 'room': '13) ЛФВЭ корп.215 ком.234', 'lab': 'LHEP', 'building': ''},
 {'number': '2162836', 'room': '74а', 'lab': 'LHEP', 'building': '1Б'},
 {'number': '2162882', 'room': '121', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162908', 'room': '213', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162889', 'room': '106', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162869', 'room': '215', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162929', 'room': '306', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162932', 'room': '216', 'lab': 'LHEP', 'building': '217'},
 {'number': '2162925', 'room': '304', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162928', 'room': '17', 'lab': 'LHEP', 'building': '217'},
 {'number': '2162910', 'room': '14', 'lab': 'LHEP', 'building': '42'},
 {'number': '2162921', 'room': '4', 'lab': 'LHEP', 'building': '1А'},
 {'number': '2162915', 'room': '301', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162927', 'room': '7', 'lab': 'LHEP', 'building': '1А'},
 {'number': '2162944', 'room': '109', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162938', 'room': '210', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162940', 'room': '206', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162951', 'room': '325б', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162989', 'room': '41,42', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2162981', 'room': '302', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162988', 'room': '322', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162979', 'room': '101', 'lab': 'LHEP', 'building': '42'},
 {'number': '2162961', 'room': '325б', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162983', 'room': '213', 'lab': 'LHEP', 'building': '3'},
 {'number': '2162970', 'room': '111', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162996', 'room': '201', 'lab': 'LHEP', 'building': '42'},
 {'number': '2162998', 'room': '34', 'lab': 'LHEP', 'building': '4'},
 {'number': '2163004', 'room': '204', 'lab': 'LHEP', 'building': '201'},
 {'number': '2163043', 'room': '21', 'lab': 'LHEP', 'building': '42'},
 {'number': '2163063', 'room': '107', 'lab': 'LHEP', 'building': '216'},
 {'number': '2163033', 'room': '312', 'lab': 'LHEP', 'building': '201'},
 {'number': '2164411', 'room': '119', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163092', 'room': '124б', 'lab': 'LHEP', 'building': '2'},
 {'number': '2163070', 'room': '204', 'lab': 'LHEP', 'building': '216'},
 {'number': '2163087', 'room': '219', 'lab': 'LHEP', 'building': '4'},
 {'number': '2163045', 'room': '307', 'lab': 'LHEP', 'building': '215'},
 {'number': '2162993', 'room': '114', 'lab': 'LHEP', 'building': '3'},
 {'number': '2163094', 'room': '433', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163232', 'room': '443', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163268', 'room': '72', 'lab': 'LHEP', 'building': '1Б'},
 {'number': '2163380', 'room': '302/2', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163382', 'room': '24 склад', 'lab': 'LHEP', 'building': '7 Ц.база'},
 {'number': '2163381', 'room': '302', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163436', 'room': '302/1', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163473', 'room': '212', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163498', 'room': '5', 'lab': 'LHEP', 'building': '43'},
 {'number': '2163492', 'room': '116', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163548', 'room': '102а', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163529', 'room': '4', 'lab': 'LHEP', 'building': '39'},
 {'number': '2163623', 'room': '302', 'lab': 'LHEP', 'building': '201'},
 {'number': '2163669', 'room': '206', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163686', 'room': '316б', 'lab': 'LHEP', 'building': '3'},
 {'number': '2163718', 'room': '312', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2163735', 'room': '208', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163713', 'room': '224', 'lab': 'LHEP', 'building': '201'},
 {'number': '2163724', 'room': '202,202/2', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163779', 'room': '202/2', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163820', 'room': '29,31', 'lab': 'LHEP', 'building': '39'},
 {'number': '2163807', 'room': '214', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163853', 'room': '18', 'lab': 'LHEP', 'building': '43'},
 {'number': '2163855', 'room': '306, 307', 'lab': 'LHEP', 'building': '2'},
 {'number': '2163846', 'room': '112', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163841', 'room': '317', 'lab': 'LHEP', 'building': '3'},
 {'number': '2163845', 'room': '336 стенд параллельный корп.1а п/ст 13-АРУ 6кВ', 'lab': 'LHEP', 'building': '216'},
 {'number': '2163858', 'room': '206', 'lab': 'LHEP', 'building': '201'},
 {'number': '2163850', 'room': '225', 'lab': 'LHEP', 'building': '201'},
 {'number': '2163849', 'room': '6', 'lab': 'LHEP', 'building': '1А'},
 {'number': '2163895', 'room': '110', 'lab': 'LHEP', 'building': '2'},
 {'number': '2163878', 'room': '109', 'lab': 'LHEP', 'building': '3'},
 {'number': '2163881', 'room': '205', 'lab': 'LHEP', 'building': '201'},
 {'number': '2163876', 'room': '2', 'lab': 'LHEP', 'building': '1А'},
 {'number': '2163913', 'room': '311', 'lab': 'LHEP', 'building': '2'},
 {'number': '2163928', 'room': '116а', 'lab': 'LHEP', 'building': '201'},
 {'number': '2163932', 'room': '209', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2163901', 'room': '9', 'lab': 'LHEP', 'building': '42'},
 {'number': '2163919', 'room': '225', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163909', 'room': '105', 'lab': 'LHEP', 'building': '201'},
 {'number': '2163936', 'room': '203', 'lab': 'LHEP', 'building': '2'},
 {'number': '2163960', 'room': '207', 'lab': 'LHEP', 'building': '201'},
 {'number': '2163952', 'room': '342', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163942', 'room': '201б', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163948', 'room': '103б', 'lab': 'LHEP', 'building': '3'},
 {'number': '2163990', 'room': '345', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163978', 'room': '18', 'lab': 'LHEP', 'building': '4 заготовительный участок'},
 {'number': '2163971', 'room': '113а,113б', 'lab': 'LHEP', 'building': '3'},
 {'number': '2164044', 'room': '219', 'lab': 'LHEP', 'building': '201'},
 {'number': '2164037', 'room': '323', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164046', 'room': '323', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164052', 'room': '315', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164064', 'room': '113в,113г', 'lab': 'LHEP', 'building': '3'},
 {'number': '2164067', 'room': '330', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164081', 'room': '115', 'lab': 'LHEP', 'building': '216'},
 {'number': '2164093', 'room': '380в', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164096', 'room': '114', 'lab': 'LHEP', 'building': '216'},
 {'number': '2164334', 'room': '301/2,303', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164391', 'room': '301', 'lab': 'LHEP', 'building': '2'},
 {'number': '2164375', 'room': '122', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164476', 'room': '318/1', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164478', 'room': '301/2', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164636', 'room': '113', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164645', 'room': '208)', 'lab': 'LHEP', 'building': '205 2-й этаж ниша сервера (рядом с'},
 {'number': '2164680', 'room': '308', 'lab': 'LHEP', 'building': '3'},
 {'number': '2164743', 'room': '301', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2164734', 'room': '325', 'lab': 'LHEP', 'building': '21'},
 {'number': '2164773', 'room': '106', 'lab': 'LHEP', 'building': '217'},
 {'number': '2164760', 'room': '20', 'lab': 'LHEP', 'building': '42'},
 {'number': '2164818', 'room': '335', 'lab': 'LHEP', 'building': '215'},
 {'number': '2164792', 'room': '210', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164837', 'room': '26', 'lab': 'LHEP', 'building': '4 (гравер)'},
 {'number': '2164912', 'room': '120', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164997', 'room': '123', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164972', 'room': '301/3, ком.308', 'lab': 'LHEP', 'building': '205'},
 {'number': '2164986', 'room': '17', 'lab': 'LHEP', 'building': '4 (мастерская)'},
 {'number': '2165211', 'room': '203', 'lab': 'LHEP', 'building': '42'},
 {'number': '2165216', 'room': '433а', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165221', 'room': '206', 'lab': 'LHEP', 'building': '42'},
 {'number': '2165318', 'room': '310', 'lab': 'LHEP', 'building': '201'},
 {'number': '2165305', 'room': '103а', 'lab': 'LHEP', 'building': '3'},
 {'number': '2165388', 'room': '124а', 'lab': 'LHEP', 'building': '2'},
 {'number': '2165393', 'room': '24', 'lab': 'LHEP', 'building': 'старый криогенный'},
 {'number': '2165493', 'room': '212', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165615', 'room': '302', 'lab': 'LHEP', 'building': '2 пульт с/ф серверы ЛВС Нуклотрона'},
 {'number': '2165590', 'room': '302', 'lab': 'LHEP', 'building': '2 пульт с/ф - антресоль'},
 {'number': '2165592', 'room': '33', 'lab': 'LHEP', 'building': '4'},
 {'number': '2166158', 'room': '327', 'lab': 'LHEP', 'building': '201'},
 {'number': '2166143', 'room': '13', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2166246', 'room': '303', 'lab': 'LHEP', 'building': '3'},
 {'number': '2166857', 'room': '214', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162092', 'room': '313', 'lab': 'LHEP', 'building': '2'},
 {'number': '2165174', 'room': '227', 'lab': 'LHEP', 'building': '201'},
 {'number': '2163929', 'room': '313', 'lab': 'LHEP', 'building': '201'},
 {'number': '2162856', 'room': '226', 'lab': 'LHEP', 'building': '215'},
 {'number': '2164938', 'room': '434а', 'lab': 'LHEP', 'building': '215'},
 {'number': '2164949', 'room': '310', 'lab': 'LHEP', 'building': '215'},
 {'number': '2164914', 'room': '210', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163262', 'room': '211', 'lab': 'LHEP', 'building': '205'},
 {'number': '2165468', 'room': '3', 'lab': 'LHEP', 'building': '236 (модульный)'},
 {'number': '2164532', 'room': '114', 'lab': 'LHEP', 'building': '205'},
 {'number': '2163037', 'room': '301', 'lab': 'LHEP', 'building': '2'},
 {'number': '2163515', 'room': '301', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162066', 'room': '108', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162862', 'room': '204,205', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2163643', 'room': '112', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165575', 'room': '13', 'lab': 'LHEP', 'building': '8Б / /корп.8Г'},
 {'number': '2162903', 'room': '303', 'lab': 'LHEP', 'building': '2'},
 {'number': '2164663', 'room': '215', 'lab': 'LHEP', 'building': '215'},
 {'number': '2166456', 'room': '447', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163322', 'room': '202', 'lab': 'LHEP', 'building': '1 ЛУ-20'},
 {'number': '2164062', 'room': '224 (перекл.пункт)', 'lab': 'LHEP', 'building': '205'},
 {'number': '2162955', 'room': '206,221', 'lab': 'LHEP', 'building': '3'},
 {'number': '2163001', 'room': '1', 'lab': 'LHEP', 'building': '22'},
 {'number': '2164248', 'room': '308', 'lab': 'LHEP', 'building': '205'},
 {'number': '2165664', 'room': '313', 'lab': 'LHEP', 'building': '3'},
 {'number': '2163342', 'room': '434', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165033', 'room': '305', 'lab': 'LHEP', 'building': '2'},
 {'number': '2165051', 'room': '209', 'lab': 'LHEP', 'building': '201'},
 {'number': '2165080', 'room': '409', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165269', 'room': '337', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165289', 'room': '110', 'lab': 'LHEP', 'building': '201'},
 {'number': '2165306', 'room': '235', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165297', 'room': '318', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165517', 'room': '207а', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165357', 'room': '323', 'lab': 'LHEP', 'building': '3'},
 {'number': '2165469', 'room': '309', 'lab': 'LHEP', 'building': '201'},
 {'number': '2165497', 'room': '44', 'lab': 'LHEP', 'building': '39'},
 {'number': '2165547', 'room': '416', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165577', 'room': '220', 'lab': 'LHEP', 'building': '201'},
 {'number': '2165620', 'room': '49 корп.215, ком.221', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2165717', 'room': '103а', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165690', 'room': '310', 'lab': 'LHEP', 'building': '2'},
 {'number': '2165745', 'room': '223', 'lab': 'LHEP', 'building': '201'},
 {'number': '2165767', 'room': '229', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165813', 'room': '326', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165806', 'room': '202', 'lab': 'LHEP', 'building': '203Б'},
 {'number': '2165811', 'room': '124а', 'lab': 'LHEP', 'building': '2'},
 {'number': '2165814', 'room': '16', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2165816', 'room': '206, 207', 'lab': 'LHEP', 'building': '2'},
 {'number': '2165857', 'room': '12', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2165875', 'room': '228', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165889', 'room': '201', 'lab': 'LHEP', 'building': '2'},
 {'number': '2165933', 'room': '112', 'lab': 'LHEP', 'building': '201'},
 {'number': '2165953', 'room': '216', 'lab': 'LHEP', 'building': '215'},
 {'number': '2165993', 'room': '208', 'lab': 'LHEP', 'building': '215'},
 {'number': '2163758', 'room': '314', 'lab': 'LHEP', 'building': '215'},
 {'number': '2164692', 'room': '45', 'lab': 'LHEP', 'building': '39(адм)'},
 {'number': '2163060', 'room': '18', 'lab': 'LHEP', 'building': '7 Ц.база'},
 {'number': '2165516', 'room': '19', 'lab': 'LHEP', 'building': '7 Ц.база'},
 {'number': '2162810', 'room': '8 гальванический участок', 'lab': 'LHEP', 'building': '4'},
 {'number': '2163871', 'room': '308', 'lab': 'LHEP', 'building': '201'},
 {'number': '2165126', 'room': '236(на вр.ремонта данные2163904)', 'lab': 'LHEP', 'building': '215'},
 {'number': '2166205', 'room': '403', 'lab': 'LHEP', 'building': '215'}]      ;

[end]

[draw rooms]

var check_sel;
var che;
var defaultDivColor = "##eeee00"
function toColor(num) {
    let out = ' ##'  + (+num).toString(16).padStart(6, '0');;
    return out;
}


function try_colorSQR(){
	let divs = lit.attributes.Departments;
 	for (i in divs){
            let divsqr;
            let sqrid='SQR'+divs[i].id;
            divsqr = document.getElementById(sqrid);
            if ( typeof(divsqr) !== "undefined" && divsqr !== null ) {
                 divsqr.style["background-color"]= toColor(divs[i].systemColor);
               //  console.log('COLOR SQR '+sqrid+' '+JSON.stringify(divs[i])+' '+toColor( divs[i].systemColor));
               //  console.log(toColor( divs[i].systemColor));
            }
            if (divs[i].id!=='643000'){continue;}
            sqrid='SQR606000';
            divsqr = document.getElementById(sqrid);
            if ( typeof(divsqr) !== "undefined" && divsqr !== null ) {
                 divsqr.style["background-color"]= toColor(divs[i].systemColor);
             //    console.log('COLOR SQR '+sqrid+' '+JSON.stringify(divs[i])+' '+toColor( divs[i].systemColor));
              //   console.log(toColor( divs[i].systemColor));
            }



		
    }
}
var a = {"Ё":"YO","Й":"I","Ц":"TS","У":"U","К":"K","Е":"E","Н":"N","Г":"G","Ш":"SH","Щ":"SCH","З":"Z","Х":"H","Ъ":"'","ё":"yo","й":"i","ц":"ts","у":"u","к":"k","е":"e","н":"n","г":"g","ш":"sh","щ":"sch","з":"z","х":"h","ъ":"'","Ф":"F","Ы":"I","В":"V","А":"А","П":"P","Р":"R","О":"O","Л":"L","Д":"D","Ж":"ZH","Э":"E","ф":"f","ы":"i","в":"v","а":"a","п":"p","р":"r","о":"o","л":"l","д":"d","ж":"zh","э":"e","Я":"Ya","Ч":"CH","С":"S","М":"M","И":"I","Т":"T","Ь":"'","Б":"B","Ю":"YU","я":"ya","ч":"ch","с":"s","м":"m","и":"i","т":"t","ь":"'","б":"b","ю":"yu"};

function transliterate(word){
  return word.split('').map(function (char) { 
    return a[char] || char; 
  }).join("");
}
function getRoomPhone(roomName){
    let phlist = '';
    let roomn = transliterate(roomName.toLowerCase());
    for (i in phones){
        let r = phones[i].room;
        let b = phones[i].building;
        if ('215' !== b.trim()) {
            continue;
        }

        if (roomn.trim() == r){
            if (phlist.length>0){
                phlist +=  ', ';
            }
            phlist +=  phones[i].number;
        }
    }
    
    return phlist;
}


function getDivProp(div_code){
	let divs = lit.attributes.Departments;
 	for (i in divs){
//		console.log(i+' '+divs[i].id+' '+divs[i].name+' '+divs[i].systemColor);
		if (divs[i].id == div_code) {return divs[i]};
        }
	
	return "";
}

function showSotr(tabn){
 ShowDialog(); AjaxCall('popupCont', 'c=edit/personal&edit=no&tab_n='+tabn, true); ??right_level=333|pers_admin|personal_view
}


function getRoomCoordinates(roomData){
    let roomCoordinates = [];
    for (var j = 0; j < roomData.geometry.coordinates.length; j++) {
      roomCoordinates.push([
        rescaleX(roomData.geometry.coordinates[j][0]),
        rescaleY(roomData.geometry.coordinates[j][1]),
      ]);
    }
    return roomCoordinates;
}
function getRoomInfo(roomID){
    return rooms_info[roomID];
}

function fill_rooms_info(){
      console.log('!!!! BEGIN FILL INFO');
//    for (i in lit){
//        console.log('lit entry = '+i);
//      for (j in lit[i]){
//        console.log('lit entry = '+i +' '+j);
//      for (k in lit[i][j]){
//        console.log('lit entry = '+i +' '+j+' '+k);
//        }
//
//      }
//    }
    let all_rooms_data = rooms_json.layers.Rooms.layerRaws;
    var arr = [];
    for (let i = 0; i < all_rooms_data.length; i++){
	var room = all_rooms_data[i];
//	debugger;
//	console.log(JSON.stringify(all_rooms_data));
//	console.log(JSON.stringify(room));
        var room_id = all_rooms_data[i].properties.id;
        all_rooms_data[i].properties.id = room_id;
        var room_name = all_rooms_data[i].properties.name.toUpperCase().trim() ;
//	console.log('>>>>>>PROCESS room num='+room_name+' '+JSON.stringify(all_rooms_data[i]));
        
        var room_floor = all_rooms_data[i].geometry.floor;
        var ppls_arr = [];
        if (room_name.length>0){
            if (room_name == '201'){console.log('$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ROOM='+room_name+' litsotr len='+lhep_sotr.length);}

            for (let j = 0; j < lhep_sotr.length; j++){
                let tmprooms = [lhep_sotr[j].rooms.trim().toUpperCase()];
                let building = lhep_sotr[j].buildings.trim().toUpperCase();
                if (room_name == '201'){console.log(lhep_sotr.length+'$$$$$$$$$$ROOM=201 CHECK '+JSON.stringify(lhep_sotr[j]) );}
                if (lhep_sotr[j].rooms.indexOf(',')>-1) {
                    tmprooms = lhep_sotr[j].rooms.toUpperCase().split(',');
                    tmprooms.map(s => s.trim());
                }
                if ( tmprooms.indexOf(room_name) > -1 & building.indexOf('#plan_building_id#') > -1 ) {

                    let fio = lhep_sotr[j].f + " " + lhep_sotr[j].i + " " + lhep_sotr[j].o;
                    ppls_arr.push({"FL_ID":lhep_sotr[j].fl_id, "TABN":lhep_sotr[j].tabn, "TOPDIVCODE":lhep_sotr[j].TopParent_code, "SUBDIVCODE":lhep_sotr[j].SubTopParent_code, "FIO":fio});
                    console.log('ROOM add sotr='+room_name+' add ppl '+JSON.stringify(lhep_sotr[j]));
                }
            }
        }
        var room_coord = getRoomCoordinates(all_rooms_data[i]);
        var minX = maxX = room_coord[0][0];
        var minY = maxY = room_coord[0][1];
        for (let b = 0; b < room_coord.length; b++){
            if (room_coord[b][0] < minX){
                minX = room_coord[b][0];
            }
            if (room_coord[b][0] > maxX){
                maxX = room_coord[b][0];
            }
            if (room_coord[b][1] < minY){
                minY = room_coord[b][1];
            }
            if (room_coord[b][1] > maxY){
                maxY = room_coord[b][1];
            }
        }
        var square = ((maxX - minX) * (maxY - minY) * 13 * 13) / 100;
        var size = 0;
        rooms_info[room_id] = {"id":room_id, "name":room_name, "floor":room_floor, "PPLS":ppls_arr, "SQR":square, "size":size, "geo_json":room_coord};
//        console.log('!!!! ROOM ID='+room_id+' ='+JSON.stringify(rooms_info[room_id]));
    //    if (room_name.indexOf('607')>-1) {console.log(   room_name+' ===   '+JSON.stringify(rooms_info[room_id]));}
    }
      console.log('!!!! END FILL INFO');

}




function centerRoom(room_num){
   if (room_num.length<2) {
        return;
    }
    
   let aa = $('[id='+room_num[0]+'][name=floornum]');
   console.log(room_num[0]) 
   aa.click();
   addRooms();
   for (r in rooms_info){
//    console.log(room_num+' '+r+' '+rooms_info[r].name+' '+rooms_info);
    if (rooms_info[r].name == room_num.toUpperCase()){
        console.log('!!!!!!!!!!'+rooms_info[r].geo_json);
	let geo = [0,0];
	for (i in rooms_info[r].geo_json) {
		geo[0] += rooms_info[r].geo_json[i][0];
		geo[1] += rooms_info[r].geo_json[i][1];
		console.log('CENTER ROOM !!!!!!!!!!!!!!!!! ' +geo + '  '+i+'= '+rooms_info[r].geo_json[i])
	}
	geo[0] /=  rooms_info[r].geo_json.length;
	geo[1] /=  rooms_info[r].geo_json.length ;
	console.log(geo + '  '+rooms_info[r].geo_json.length );
        red_mark.setLatLng(geo);
        roomsGrp.addLayer(red_mark);
        lit_map.panTo(geo)
        break;
    }
   } 
    
}
var flip = false;
function addRooms() {
  roomsGrp.clearLayers();
  console.log(' Begin  add Rooms '+roomsGrp +' lit='+ 'JSON.stringify(lit)');
  check_sel = $("input[type='radio'][name='floornum']:checked").val();
  image = L.imageOverlay('images/plans/lhep/215-'+check_sel +'.png', bounds).addTo(lit_map);
  let aaa = $("input[type='radio'][name='floornum']:checked");
  console.log('aaa='+aaa);
  let data = rooms_json.layers.Rooms.layerRaws.filter(function (item, i, arr) {
    if (item.geometry.floor == check_sel) return item;
  });
  console.log(check_sel+'!!!!!!!!!!!!!!!!!!!!! Rooms '+ JSON.stringify(data));

  for (var i = 0; i < data.length; i++) {
//     console.log(' Room '+data[i].properties.name+' '+ JSON.stringify(data[i].geometry.coordinates));
//    console.log('FILL ROOM '+JSON.stringify(data[i].properties))
    let latlngs = getRoomCoordinates(data[i]);
    var rColor = "##eeeeee";
    var roomName = data[i].properties.name;
    let room_id =  data[i].properties.id;
    var descr = "";
    var Owner = "";
    var room_info = getRoomInfo(room_id);
//    console.log('ROOM info'+JSON.stringify(room_info))
    
    if (roomName != ""){
        var descr = "<LNG L=ru>Комната</LNG>: "+ roomName+"<br>";
        let roomPhone = getRoomPhone(roomName);
        if (roomPhone.length>2){
            descr+="<LNG L=ru>Телефон</LNG>: "+ roomPhone+"<br>";
        }
//        console.log(latlngs);
        for (let j = 0; j < room_info.PPLS. length; j++){
            descr += "<a href='##' onclick='showSotr(+" + room_info.PPLS[j].TABN + ")';>"+room_info.PPLS[j].FIO + "</a><BR> ";
            if (room_info.PPLS[j].TOPDIVCODE == room_info.PPLS[j].SUBDIVCODE) {
                descr += lhep_divName(room_info.PPLS[j].SUBDIVCODE)+'<br>';
            } else {
                descr += lhep_divName(room_info.PPLS[j].TOPDIVCODE)+ ' '+ lhep_divName(room_info.PPLS[j].SUBDIVCODE)+'<br>';
            }
            ;
            Owner = room_info.PPLS[j].SUBDIVCODE;
//            console.log(roomName+' = '+JSON.stringify(room_info.PPLS[j])+' '+Owner);
        }
        if (Owner != "") {
//                descr += "Отдел: " + lhep_divFunc(Owner) + "<br>";
//               console.log('getDivProp '+JSON.stringify(getDivProp(Owner)));
               rColor = toColor((+getDivProp(Owner).systemColor));
               rColor = toColor(+Owner);
               rColor = '##02f9b9'
        }
        
    }
        descr += "Площадь: " + parseInt(room_info.SQR)+' кв.м';

        
//    console.log(roomName+' '+rColor)
    polyline = L.polygon(latlngs, {
      fillColor: rColor,
      fillOpacity: 0.9,
      color: "black",
      weight: 1,
    });

    polyline.bindTooltip(roomName, {
        permanent: true,
        direction: "center",
        className: "lhep_obj_tooltip",
      })
      .openTooltip();
    polyline.bindPopup(descr, {
      autoPanPaddingTopLeft: [50, 50],
      className: "lhep_obj_popup",
    }).on;
    roomsGrp.addLayer(polyline);
    room_info.geo_json = latlngs;
//   console.log(' polyline '+latlngs+' '+JSON.stringify(room_info));
  }
try_colorSQR();
//   console.log('=================== LOAD_ALL_ICON !!!!!!!!!!!!!!!!!!!!!!!!!!!');
load_all_icon(check_sel, #plan_building_id#);
//   console.log('=================== end LOAD_ALL_ICON !!!!!!!!!!!!!!!!!!!!!!!!!!!');

}

function test_room(){
  var latlngs = [
    [1, 1],
    [200, 200],
    [1, 300],
  ];
  polyline = L.polygon(latlngs, {
    fillOpacity: 1,
    color: "red",
    weight: 2,
  }).addTo(lit_map);
}


function rescaleX(x) {
	return x/ 10;
  return parseInt(aaa);
return x

}

function rescaleY(y) {
	return y/ 10;
    return parseInt(aaa);
return y
}


[end]
